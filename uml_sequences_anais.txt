
------------------------
title Authentification\nAnaïs Decolle

Actor Acheteur
participant EMarché
Acheteur -> EMarché: Authentification
EMarché -> Acheteur: Authentification réussie
------------------------
title Rechercher les ventes en cours par mots clés\nAnaïs Decolle

Actor Acheteur
participant EMarché
activate EMarché
Acheteur -> EMarché: Authentification
EMarché -> Acheteur: Authentification réussie
    Acheteur -> EMarché: Envoi mots clés
    EMarché -> EMarché: Recherche des ventes en cours avec la référence, le nom\nou la catégorie correspondants aux mots clés
    EMarché -> EMarché: Sélection des premières ventes par prix croissant (avec un nombre max de sélection)
    EMarché -> Acheteur: Liste des ventes en cours correspondantes\n(référence, nom, catégorie, photo, prix, quantité, pseudoVendeur, dateLimite (si enchère))
deactivate EMarché
-------------------------
title Consulter les ventes en cours\nAnaïs Decolle

Actor Acheteur
participant EMarché
activate EMarché
	Acheteur -> EMarché: Authentification
	EMarché -> Acheteur: Authentification réussie
    EMarché -> EMarché: Recherche des ventes en cours 
    EMarché -> EMarché: Sélection des premières ventes par ordre d'ancienneté\n(en partant du plus récent et avec un nombre max de sélection)
    EMarché -> Acheteur: Liste des ventes en cours\n(référence, nom, catégorie, photo, prix, quantité, pseudoVendeur, noteVendeur, dateLimite (si enchère))
deactivate EMarché
-------------------------
title Rechercher un profil par mots clés\nAnaïs Decolle

Actor Acheteur
participant EMarché
activate EMarché
	Acheteur -> EMarché: Authentification
	EMarché -> Acheteur: Authentification réussie
    Acheteur -> EMarché: Envoi mots clés
    EMarché -> EMarché: Recherche des pseudos correspondants\naux mots clés
    EMarché -> EMarché: Sélection des premiers pseudos correspondants\n(avec un nombre max de sélection)
    EMarché -> Acheteur: Liste des profils correspondants\n(photo, pseudo, note)
deactivate EMarché
-------------------------
title Acheter un produit\nAchat standard (sans enchère)\nAnaïs Decolle
Actor Acheteur
participant EMarché
activate EMarché
	Acheteur -> EMarché: Authentification
	EMarché -> Acheteur: Authentification réussie
    Acheteur -> EMarché: Envoi produit choisi (référence) et quantité
    EMarché -> EMarché: Coordonnées bancaires enregistrées dans le profil
    EMarché -> Banque: Demande de confirmation
    Banque -> Banque: Vérification de l'état du compte
    Banque -> EMarché: Confirmation
    activate Vendeur
    EMarché -> Vendeur: Notification de la vente\n(pseudo de l'acheteur, adresse de livraison, adresse de facturation,\nréférence produit, nom, quantité, date, heure, délai pour envoyer, type de livraison)
    deactivate Vendeur
    alt Stock encore disponible après transaction
    	EMarché -> EMarché: Ajustement de la quantité restante du produit
    else Epuisement du stock
    	EMarché -> EMarché: Ajout dans les produits vendus
        EMarché -> EMarché: Mise à jour des produits vendus dans le profil du vendeur
        EMarché -> EMarché: Suppression du produit dans les ventes en cours
        EMarché -> EMarché: Mise à jour des produits en vente dans le profil du vendeur
    end
    EMarché -> EMarché: Ajout dans les produits achetés dans le profil de l'acheteur
    EMarché -> Acheteur: Confirmation de l'achat
deactivate EMarché
-------------------------
title Acheter un produit\nAchat standard (sans enchère)\ncas de coordonnées bancaires absentes du profil\nAnaïs Decolle

Actor Acheteur
participant EMarché
activate EMarché
	Acheteur -> EMarché: Authentification
	EMarché -> Acheteur: Authentification réussie
	Acheteur -> EMarché: Envoi produit choisi (référence) et quantité
    EMarché -> EMarché: Absence de coordonnées bancaires enregistrées dans le profil
    EMarché -> Acheteur: Formulaire coordonnées bancaires\n(nom, prénom, numéro de carte, type de carte : Visa ou Mastercard ou Paypal,\nnuméro secret, date de validité, adresse de livraison, adresse de facturation,\ntype de livraison : Colissimo ou envoi standard, confirmation de l'achat, acceptation des conditions générales de vente)
    Acheteur -> EMarché: Envoi coordonnées bancaires
    	EMarché -> Banque: Demande de confirmation
        Banque -> Banque: Vérification de l'état du compte
        Banque -> EMarché: Confirmation
    EMarché -> Acheteur: Proposition d'enregistrement des coordonnées bancaires
    alt Enregistrement accepté
    Acheteur -> EMarché: Confirmation de l'enregistrement
    EMarché -> EMarché: Enregistrement des coordonnées\nbancaires dans le profil de l'acheteur
    else Enregistrement refusé
    Acheteur -> EMarché: Refus de l'enregistrement
    end
    activate Vendeur
    EMarché -> Vendeur: Notification de la vente\n(pseudo de l'acheteur, adresse de livraison, adresse de facturation,\nréférence produit, nom, quantité, date, heure, délai pour envoyer, type de livraison)
    deactivate Vendeur
    alt Stock encore disponible après transaction
    	EMarché -> EMarché: Ajustement de la quantité restante du produit
    else Epuisement du stock
    	EMarché -> EMarché: Ajout dans les produits vendus
        EMarché -> EMarché: Mise à jour des produits vendus dans le profil du vendeur
        EMarché -> EMarché: Suppression du produit dans les ventes en cours
        EMarché -> EMarché: Mise à jour des produits en vente dans le profil du vendeur
    end
EMarché -> EMarché: Ajout dans les produits achetés dans le profil de l'acheteur
    EMarché -> Acheteur: Confirmation de l'achat
deactivate EMarché
-------------------------
title Acheter un produit\nAchat standard (sans enchère)\ncas de refus de la banque\nAnaïs Decolle

Actor Acheteur
participant EMarché
activate EMarché
Acheteur -> EMarché: Authentification
EMarché -> Acheteur: Authentification réussie
    Acheteur -> EMarché: Envoi produit choisi (référence) et quantité
    EMarché -> EMarché: Coordonnées bancaires enregistrées dans le profil
    EMarché -> Banque: Demande de confirmation
    Banque -> Banque: Vérification de l'état du compte
	Banque -> EMarché: Refus
	EMarché -> Acheteur: Annulation de l'achat "Refus de la banque"
deactivate EMarché
-------------------------
title Enchérir\nAnaïs Decolle
Actor Acheteur
participant EMarché
	activate EMarché
		Acheteur -> EMarché: Authentification
		EMarché -> Acheteur: Authentification réussie
    	Acheteur -> EMarché: Envoi produit choisi pour enchérir
        EMarché -> EMarché: Vérification enchère toujours en cours
        EMarché -> EMarché: Vérification prix actuel
        EMarché -> Acheteur: Demande du nouveau prix\n(supérieur au prix actuel)
        Acheteur -> EMarché: Envoi nouveau prix
        EMarché -> EMarché: Enregistrement du nouveau prix actuel
alt produit déjà présent dans les achats en cours de l'acheteur
EMarché -> EMarché: Mise à jour des achats en cours dans le profil de l'acheteur
else produit absent dans les achats en cours de l'acheteur
EMarché -> EMarché: Ajout du produit dans les achats en cours dans le profil de l'acheteur
end
        EMarché -> EMarché: Ajout de l'acheteur en tête de liste des acheteurs\n(avec un nombre max d'acheteurs retenus)\n(pour le cas où l'acheteur final annule son achat ou ne peut pas payer,\npour pouvoir prendre le suivant, ou annuler la vente si aucun acheteur valide)
        EMarché -> Acheteur: Validation de l'enchère
        EMarché -> "Ancien acheteur en tête": Notification d'une enchère supérieure à la sienne\n(référence produit, nom, prix, date fin de l'enchère)
    deactivate EMarché
-------------------------
title Acheter un produit\nCas de fin d'une enchère\nAnaïs Decolle
Actor Acheteur
participant EMarché
activate EMarché
	Acheteur -> EMarché: Authentification
	EMarché -> Acheteur: Authentification réussie
    EMarché -> EMarché: Suppression du produit dans les ventes en cours 
    EMarché -> EMarché: Sélection de l'acheteur en tête de liste
    EMarché -> Acheteur: Notification fin d'enchère (référence produit, nom, prix actuel, vendeur, délai de paiement)
    EMarché -> Acheteur: Validation de l'achat
    Acheteur -> EMarché: Achat validé
EMarché -> EMarché: Coordonnées bancaires enregistrées dans le profil
    EMarché -> Banque: Demande de confirmation
    Banque -> Banque: Vérification de l'état du compte
	Banque -> EMarché: Confirmation  
	activate Vendeur
    EMarché -> Vendeur: Notification de la vente\n(pseudo de l'acheteur, adresse de livraison, adresse de facturation,\nréférence produit, nom, date, heure, délai pour envoyer, type de livraison)
    deactivate Vendeur
    EMarché -> EMarché: Mise à jour des produits vendus dans le profil du vendeur
    EMarché -> EMarché: Mise à jour des produits en vente dans le profil du vendeur
  EMarché -> EMarché: Ajout du produit dans les achats du profil de l'acheteur
    EMarché -> Acheteur: Confirmation de l'achat
 deactivate EMarché
-------------------------
title Acheter un produit\nCas de fin d'une enchère\nNon paiement de l'acheteur en tête\nAnaïs Decolle
Actor Acheteur
participant EMarché
activate EMarché
	Acheteur -> EMarché: Authentification
	EMarché -> Acheteur: Authentification réussie
    EMarché -> EMarché: Suppression du produit dans les ventes en cours 
    EMarché -> EMarché: Sélection de l'acheteur en tête de liste
    EMarché -> Acheteur: Notification fin d'enchère (référence produit, nom, prix actuel, vendeur, délai de paiement)
    EMarché -> Acheteur: Validation de l'achat
    loop Délai de paiement dépassé
    EMarché -> EMarché: Suppression de l'acheteur en tête de liste
    EMarché -> EMarché: Sélection de l'acheteur en tête de liste
    EMarché -> Acheteur: Notification fin d'enchère (référence produit, nom, prix actuel, vendeur, délai de paiement)
    EMarché -> Acheteur: Validation de l'achat
    end
    Acheteur -> EMarché: Achat validé
EMarché -> EMarché: Coordonnées bancaires enregistrées dans le profil
    EMarché -> Banque: Demande de confirmation
    Banque -> Banque: Vérification de l'état du compte
	Banque -> EMarché: Confirmation  
    EMarché -> EMarché: Mise à jour des produits vendus dans le profil du vendeur
    EMarché -> EMarché: Mise à jour des produits en vente dans le profil du vendeur
    activate Vendeur
    EMarché -> Vendeur: Notification de la vente\n(pseudo de l'acheteur, adresse de livraison, adresse de facturation,\nréférence produit, nom, date, heure, délai pour envoyer, type de livraison)
    deactivate Vendeur
EMarché -> EMarché: Ajout du produit dans les achats de l'acheteur
    EMarché -> Acheteur: Confirmation de l'achat
 deactivate EMarché
-------------------------
title Fin d'une enchère\nPas/plus d'acheteur (du au délai de paiement ou non)\nAnaïs Decolle
participant EMarché
activate EMarché
    EMarché -> EMarché: Suppression du produit dans les ventes en cours 
	EMarché -> EMarché: Mise à jour des produits en vente dans le profil du vendeur
    activate Vendeur
    EMarché -> Vendeur: Notification échec de la vente\n(référence produit, nom, prix actuel, date début de l'enchère, date fin de l'enchère)
 	deactivate Vendeur
 deactivate EMarché
-------------------------
title Déconnexion\nAnaïs Decolle
Actor Acheteur
participant EMarché
activate EMarché
Acheteur -> EMarché: Demande de déconnexion
EMarché -> EMarché: Modification de l'état de l'acheteur
EMarché -> Acheteur: Déconnexion
deactivate EMarché
-------------------------
title Changement de page\nAnaïs Decolle
Actor Acheteur
participant EMarché
activate EMarché
alt demande de la page précédente
EMarché -> EMarché: Vérification qu'on n'est pas en début de liste
EMarché -> EMarché: Sélection des éléments précédents dans la liste (avec un nombre défini d'éléments)
EMarché -> Acheteur: Affichage des éléments sélectionnés
else demande de la page suivante
EMarché -> EMarché: Vérification qu'on n'est pas en fin de liste
EMarché -> EMarché: Sélection des éléments suivants dans la liste (avec un nombre défini d'éléments max)
EMarché -> Acheteur: Affichage des éléments sélectionnés
end
deactivate EMarché
-------------------------
title Diagramme de cas d'utilisation de l'acheteur\nAnaïs Decolle

Actor Acheteur
left to right direction
Acheteur -- (Consulter les ventes en cours)
(Consulter les ventes en cours) ..> (Authentification) : include
Acheteur -- (Rechercher les ventes en cours par mots-clés)
(Rechercher les ventes en cours par mots-clés) ..> (Authentification) : include
Acheteur -- (Acheter un produit)
(Acheter un produit) ..> (Authentification) : include
Acheteur -- (Enchérir)
(Enchérir) ..> (Authentification) : include
Acheteur -- (Rechercher un profil par mots-clés)
(Rechercher un profil par mots-clés) ..> (Authentification) : include
Acheteur -- (Consulter un profil)
(Consulter un profil) ..> (Authentification) : include
Acheteur -- (Consulter son compte)
(Consulter son compte) ..> (Authentification) : include
Acheteur -- (Donner son avis sur un produit)
(Donner son avis sur un produit) ..> (Authentification) : include
Acheteur -- (Donner son avis sur un vendeur)
(Donner son avis sur un vendeur) ..> (Authentification) : incldue
Acheteur -- (Dialoguer avec un vendeur)
(Dialoguer avec un vendeur) ..> (Authentification) : include
Acheteur -- (Poser une réclamation)
(Poser une réclamation) ..> (Authentification) : include
Acheteur -- (Annuler un achat)
(Annuler un achat) ..> (Authentification) : include
---------------------------
title Dépôt d'un article en vente\nAnaïs Decolle

Actor Vendeur
participant EMarché
activate EMarché
Vendeur -> EMarché: Authentification
EMarché -> Vendeur: Authentification réussie
EMarché -> Vendeur: Demande choix vente standard ou enchère
Vendeur -> EMarché: Envoi choix
alt Vente standard
EMarché -> Vendeur: Formulaire d'enregistrement du produit\n(nom, catégorie, quantité, prix_unitaire, photo) 
Vendeur -> EMarché: Envoi des données du produit
else Vente aux enchères
EMarché -> Vendeur: Formulaire d'enregistrement du produit\n(nom, catégorie, quantité, prix de base, photo, date limite) 
Vendeur -> EMarché: Envoi des données du produit 
end
EMarché -> EMarché: Vérification des données
EMarché -> EMarché: Attribution d'une référence unique au produit
EMarché -> EMarché: Ajout aux ventes en cours
EMarché -> EMarché: Mise à jour des ventes en cours dans le profil du vendeur
EMarché -> Vendeur: Confirmation de l'ajout du produit
deactivate EMarché
--------------------------
title Dépôt d'un article en vente\nCas de données du produit invalides\nAnaïs Decolle

Actor Vendeur
participant EMarché
activate EMarché
Vendeur -> EMarché: Authentification
EMarché -> Vendeur: Authentification réussie
EMarché -> Vendeur: Demande choix vente standard ou enchère
Vendeur -> EMarché: Envoi choix
alt Vente standard
EMarché -> Vendeur: Formulaire d'enregistrement du produit\n(nom, catégorie, quantité, prix_unitaire, photo) 
Vendeur -> EMarché: Envoi des données du produit
else Vente aux enchères
EMarché -> Vendeur: Formulaire d'enregistrement du produit\n(nom, catégorie, quantité, prix de base, photo, date limite) 
Vendeur -> EMarché: Envoi des données du produit 
end
EMarché -> EMarché: Vérification des données
EMarché -> Vendeur: Données incorrectes, Dépôt refusé
deactivate EMarché
--------------------------
title Annulation d'une vente\nAnaïs Decolle

Actor Vendeur
participant EMarché
activate EMarché
Vendeur -> EMarché: Authentification
EMarché -> Vendeur: Authentification réussie
Vendeur -> EMarché: Choix du produit à retirer de la vente
alt Produit en vente aux enchères
EMarché -> "Acheteurs ayant enchéri sur le produit": Notification de suppression de la vente
end
EMarché -> EMarché: Suppression du produit des ventes en cours
EMarché -> EMarché: Mise à jour des ventes en cours dans le profil du vendeur
EMarché -> Vendeur: Confirmation de la suppression
deactivate EMarché
---------------------------
title Diagramme de classe\nMagalie Mallinger

class Utilisateur {
# String pseudo
# String motDePasse
# String nom
# String prenom
# date dateNaissance
# String email
# String adresse
# int nbVentes
# int nbAchats
# int noteGlobale
}

abstract class EtatConnexion {

}

class EtatConnecte {

}

class EtatDeconnecte {

}

class CoordsBancaires {
# String typeCarte
# int numCarte
# int cryptogramme
# date dateExpiration
# String adresseFacturation
# String adresseLivraison
}

class Categorie {
# String nom
}

class Produit {
# String nom
# String reference
# int prixUnitaire
# int quantite
# date dateDepot
# date dateAchatVente
}

abstract class EtatVente {
# boolean venteEnCours
}

class VenteEnchere {
# int prixActuel
# date dateLimite
# int tempsRestant
}

class VenteNormale {

}

class Avis {
# int note
# String commentaire
}

Utilisateur  --"*"  Produit
Categorie "1"--"*" Produit
Utilisateur --"1" CoordsBancaires
Utilisateur "1"-right-"*" Avis
Produit "1"--"*" Avis
VenteEnchere --> EtatVente
VenteNormale --> EtatVente
EtatVente "*"-- Produit
EtatConnecte --> EtatConnexion
EtatDeconnecte --> EtatConnexion
EtatConnexion "*"-- Utilisateur
LesProduits --"*" Produit
LesUtilisateurs --"*" Utilisateur